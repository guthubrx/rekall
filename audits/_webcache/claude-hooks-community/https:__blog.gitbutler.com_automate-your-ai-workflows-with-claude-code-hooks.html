<!DOCTYPE html><!--CHSkAhhsf5mxaIQmoP3y6--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-automate-with-claude.jpg"/><link rel="preload" as="image" href="https://blog.gitbutler.com/profiles/schacon.jpg"/><link rel="preload" as="image" href="https://gitbutler-docs-images-public.s3.us-east-1.amazonaws.com/AoC.webp"/><link rel="preload" as="image" href="https://gitbutler-docs-images-public.s3.us-east-1.amazonaws.com/events-25.jpg"/><link rel="preload" as="image" href="https://gitbutler-docs-images-public.s3.us-east-1.amazonaws.com/gerrit-gb.webp"/><link rel="preload" as="image" href="/footer-baner-pc.svg"/><link rel="preload" as="image" href="https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-CleanShot-2025-07-23-at-16.07.50%402x.png"/><link rel="preload" as="image" href="https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-CleanShot-2025-07-23-at-16.12.09%402x.png"/><link rel="preload" as="image" href="https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-CleanShot-2025-07-23-at-16.22.07%402x.png"/><link rel="preload" as="image" href="https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-CleanShot-2025-07-23-at-21.31.25%402x.png"/><link rel="stylesheet" href="/_next/static/css/03aa4b102f8464d8.css?dpl=dpl_8wUfxg9YxVhG59xzMo1yBQWUDoDT" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/e8484859e9345b8d.css?dpl=dpl_8wUfxg9YxVhG59xzMo1yBQWUDoDT" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/aa7ee2655b471968.css?dpl=dpl_8wUfxg9YxVhG59xzMo1yBQWUDoDT" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/cbf487129a8a4d2b.css?dpl=dpl_8wUfxg9YxVhG59xzMo1yBQWUDoDT" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-fe0b372bbd4747b1.js?dpl=dpl_8wUfxg9YxVhG59xzMo1yBQWUDoDT"/><script src="/_next/static/chunks/0a9a203b-f23d57dce9d22254.js?dpl=dpl_8wUfxg9YxVhG59xzMo1yBQWUDoDT" async=""></script><script src="/_next/static/chunks/742-0bf0c254d5fa2024.js?dpl=dpl_8wUfxg9YxVhG59xzMo1yBQWUDoDT" async=""></script><script src="/_next/static/chunks/main-app-91ec06a285b2aefb.js?dpl=dpl_8wUfxg9YxVhG59xzMo1yBQWUDoDT" async=""></script><script src="/_next/static/chunks/app/layout-b8e0df2bc697d36c.js?dpl=dpl_8wUfxg9YxVhG59xzMo1yBQWUDoDT" async=""></script><script async="" src="https://u.gitbutler.com/script.js" data-website-id="2f6dbf62-091f-4e57-bc47-7b1c6611a98b"></script><script src="/_next/static/chunks/537-0ae40026c9b2e00f.js?dpl=dpl_8wUfxg9YxVhG59xzMo1yBQWUDoDT" async=""></script><script src="/_next/static/chunks/851-4573c9321df0bc2d.js?dpl=dpl_8wUfxg9YxVhG59xzMo1yBQWUDoDT" async=""></script><script src="/_next/static/chunks/325-44f836f9c45f0190.js?dpl=dpl_8wUfxg9YxVhG59xzMo1yBQWUDoDT" async=""></script><script src="/_next/static/chunks/app/%5Bslug%5D/page-dd82191b278db490.js?dpl=dpl_8wUfxg9YxVhG59xzMo1yBQWUDoDT" async=""></script><link rel="preload" as="image" href="https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-CleanShot-2025-07-23-at-21.57.55%402x.png"/><link rel="preload" as="image" href="https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-CleanShot-2025-07-23-at-21.59.48%402x.png"/><link rel="preload" as="image" href="https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-CleanShot-2025-07-23-at-22.00.59%402x.png"/><meta name="theme-color" content="#1a8583"/><meta name="color-scheme" content="light dark"/><link rel="alternate" type="application/rss+xml" title="Butler&#x27;s Log RSS Feed" href="/rss"/><link rel="alternate" type="application/feed+json" title="Butler&#x27;s Log JSON Feed" href="/feed.json"/><link rel="icon" href="/favicon.ico"/><link rel="icon" href="/favicon-16x16.png" sizes="16x16" type="image/png"/><link rel="icon" href="/favicon-32x32.png" sizes="32x32" type="image/png"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="dns-prefetch" href="https://www.youtube.com"/><link rel="dns-prefetch" href="https://www.instagram.com"/><title>Automate Your AI Workflows with Claude Code Hooks | Butler&#x27;s Log</title><meta name="description" content="Claude Code&#x27;s new hooks system is a powerful tool for automating your agent workflows. We&#x27;ll do a quick overview of what&#x27;s possible and explore a few fun examples."/><meta name="author" content="Scott Chacon"/><meta name="keywords" content="engineering, Git, GitButler, Version Control, Software Development, Programming, Developer Tools"/><meta name="creator" content="Scott Chacon"/><meta name="publisher" content="GitButler"/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><meta name="category" content="Technology"/><meta name="classification" content="Blog Post"/><meta name="theme-color" content="#1a8583"/><meta name="color-scheme" content="light dark"/><meta name="article:author" content="Scott Chacon"/><meta name="article:published_time" content="2025-07-24T14:58:56.000Z"/><meta name="article:modified_time" content="2025-07-24T14:58:56.000Z"/><meta name="article:section" content="Technology"/><meta name="article:tag" content="engineering"/><meta name="reading-time" content="10 min read"/><link rel="canonical" href="https://blog.gitbutler.com/automate-your-ai-workflows-with-claude-code-hooks"/><meta property="og:title" content="Automate Your AI Workflows with Claude Code Hooks"/><meta property="og:description" content="Claude Code&#x27;s new hooks system is a powerful tool for automating your agent workflows. We&#x27;ll do a quick overview of what&#x27;s possible and explore a few fun examples."/><meta property="og:url" content="https://blog.gitbutler.com/automate-your-ai-workflows-with-claude-code-hooks"/><meta property="og:site_name" content="Butler&#x27;s Log"/><meta property="og:locale" content="en_US"/><meta property="og:image" content="https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-automate-with-claude.jpg"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image:alt" content="Automate Your AI Workflows with Claude Code Hooks"/><meta property="og:image:type" content="image/jpeg"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2025-07-24T14:58:56.000Z"/><meta property="article:modified_time" content="2025-07-24T14:58:56.000Z"/><meta property="article:author" content="Scott Chacon"/><meta property="article:section" content="Technology"/><meta property="article:tag" content="engineering"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@gitbutler"/><meta name="twitter:creator" content="@gitbutler"/><meta name="twitter:title" content="Automate Your AI Workflows with Claude Code Hooks"/><meta name="twitter:description" content="Claude Code&#x27;s new hooks system is a powerful tool for automating your agent workflows. We&#x27;ll do a quick overview of what&#x27;s possible and explore a few fun examples."/><meta name="twitter:image" content="https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-automate-with-claude.jpg"/><link rel="icon" href="/favicon.png"/><script>
              (function() {
                try {
                  const theme = localStorage.getItem('theme') || 'system';
                  let resolvedTheme = theme;
                  
                  if (theme === 'system') {
                    resolvedTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                  }
                  
                  if (resolvedTheme === 'dark') {
                    document.documentElement.classList.add('dark');
                  }
                } catch (e) {}
              })();
            </script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js?dpl=dpl_8wUfxg9YxVhG59xzMo1yBQWUDoDT" noModule=""></script></head><body><div hidden=""><!--$--><!--/$--></div><main class="page"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Automate Your AI Workflows with Claude Code Hooks","description":"Claude Code's new hooks system is a powerful tool for automating your agent workflows. We'll do a quick overview of what's possible and explore a few fun examples.","image":"https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-automate-with-claude.jpg","author":{"@type":"Person","name":"Scott Chacon","url":"https://blog.gitbutler.com/author/schacon","image":"https://blog.gitbutler.com/profiles/schacon.jpg"},"publisher":{"@type":"Organization","name":"GitButler","logo":{"@type":"ImageObject","url":"https://blog.gitbutler.com/logo.png"}},"datePublished":"2025-07-24T14:58:56.000Z","dateModified":"2025-07-24T14:58:56.000Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.gitbutler.com/automate-your-ai-workflows-with-claude-code-hooks"},"url":"https://blog.gitbutler.com/automate-your-ai-workflows-with-claude-code-hooks","keywords":"engineering","articleSection":"Technology","wordCount":2777,"timeRequired":"PT10M","inLanguage":"en-US","isAccessibleForFree":true,"about":[{"@type":"Thing","name":"engineering"}]}</script><div class="page_postHero__Mq3E4" style="background:rgba(255, 221, 67, 0.29)"><div class="content-wrap"><nav class="BlogHeader_navbar__tDUZf grid-layout"><div class="BlogHeader_logoMarkWrapper__MWLDT"><a aria-label="Go to the main site" class="BlogHeader_logoLink__pGXyK" href="https://gitbutler.com"><svg viewBox="0 0 29 31" fill="none" xmlns="http://www.w3.org/2000/svg" class="BlogHeader_logoMark__KItG8"><path fill="currentColor" d="M0 30.2544V0.746094L14.2176 13.6672L28.48 0.746094V30.2544L14.2176 17.3781L0 30.2544Z"></path></svg></a><div class="BlogHeader_logoSlash__ZoaPx"></div></div><div class="BlogHeader_navbarContent__wKSBR"><div class="BlogHeader_blogNameWrapper__56aFL"><a class="BlogHeader_blogName__7CvBI" aria-label="Go to the blog" href="/">Butler&#x27;s Log</a><a class="BlogHeader_rssLink__qdNjX" href="/rss"><span>RSS</span><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" fill="currentColor" d="M0.5 2.75C5.33249 2.75 9.25 6.66751 9.25 11.5H10.75C10.75 5.83908 6.16092 1.25 0.5 1.25V2.75ZM5.25 11.5C5.25 8.87665 3.12335 6.75 0.5 6.75V5.25C3.95178 5.25 6.75 8.04822 6.75 11.5H5.25ZM2.5 10.75C2.5 11.4404 1.94036 12 1.25 12C0.559644 12 0 11.4404 0 10.75C0 10.0596 0.559644 9.5 1.25 9.5C1.94036 9.5 2.5 10.0596 2.5 10.75Z"></path></svg></a></div><div class="BlogHeader_navbarLinks__7Xij_"><ul class="BlogHeader_mainLinks___aYPw"><li><a target="_blank" href="https://gitbutler.com/downloads">Downloads</a></li><li><a target="_blank" href="https://docs.gitbutler.com">Docs</a></li><li><a target="_blank" href="https://discord.com/invite/MmFkmaJ42D"><span>Community</span><svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.5535 4.00498C12.5023 3.52873 11.3926 3.19086 10.2526 3C10.0966 3.27595 9.95547 3.55987 9.82976 3.85056C8.6155 3.66949 7.38067 3.66949 6.16641 3.85056C6.04064 3.5599 5.89949 3.27598 5.74357 3C4.60289 3.19247 3.4924 3.53114 2.44013 4.00747C0.351096 7.066 -0.215208 10.0486 0.0679444 12.9888C1.29133 13.8833 2.66066 14.5635 4.11639 15C4.44417 14.5637 4.73423 14.1009 4.98346 13.6164C4.51007 13.4415 4.05317 13.2256 3.61804 12.9714C3.73256 12.8892 3.84456 12.8045 3.95279 12.7223C5.21891 13.3115 6.60083 13.617 7.99997 13.617C9.39912 13.617 10.781 13.3115 12.0472 12.7223C12.1566 12.8107 12.2686 12.8954 12.3819 12.9714C11.9459 13.226 11.4882 13.4423 11.014 13.6177C11.2629 14.1019 11.553 14.5644 11.881 15C13.338 14.5653 14.7084 13.8853 15.932 12.99C16.2642 9.58032 15.3644 6.62516 13.5535 4.00498ZM5.34212 11.1806C4.55307 11.1806 3.90119 10.472 3.90119 9.60025C3.90119 8.72852 4.53042 8.0137 5.3396 8.0137C6.14879 8.0137 6.79563 8.72852 6.78179 9.60025C6.76795 10.472 6.14627 11.1806 5.34212 11.1806ZM10.6578 11.1806C9.86752 11.1806 9.21815 10.472 9.21815 9.60025C9.21815 8.72852 9.84738 8.0137 10.6578 8.0137C11.4683 8.0137 12.1101 8.72852 12.0962 9.60025C12.0824 10.472 11.462 11.1806 10.6578 11.1806Z" fill="currentColor"></path></svg></a></li><li><a target="_blank" href="https://github.com/gitbutlerapp/gitbutler"><span>Source code</span><svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.00579 1C4.13177 1 1 4.20832 1 8.17745C1 11.3502 3.00663 14.0358 5.79036 14.9864C6.1384 15.0578 6.26589 14.8319 6.26589 14.6419C6.26589 14.4755 6.25442 13.9052 6.25442 13.3109C4.30557 13.7388 3.89974 12.4553 3.89974 12.4553C3.58655 11.6235 3.1225 11.4097 3.1225 11.4097C2.48465 10.97 3.16896 10.97 3.16896 10.97C3.87651 11.0175 4.24778 11.7067 4.24778 11.7067C4.87402 12.7999 5.88315 12.491 6.28912 12.3009C6.34705 11.8374 6.53276 11.5166 6.72994 11.3384C5.1756 11.172 3.54023 10.5541 3.54023 7.79712C3.54023 7.01283 3.81844 6.37117 4.25926 5.87213C4.1897 5.69392 3.94606 4.95703 4.32895 3.97076C4.32895 3.97076 4.92048 3.78059 6.25427 4.70751C7.39742 4.39299 8.61414 4.39049 9.75717 4.70751C11.0911 3.78059 11.6826 3.97076 11.6826 3.97076C12.0655 4.95703 11.8217 5.69392 11.7522 5.87213C12.2046 6.37117 12.4714 7.01283 12.4714 7.79712C12.4714 10.5541 10.836 11.16 9.27003 11.3384C9.52529 11.5641 9.74555 11.9919 9.74555 12.6692C9.74555 13.6317 9.73408 14.4042 9.73408 14.6418C9.73408 14.8319 9.86171 15.0578 10.2096 14.9865C12.9933 14.0357 15 11.3502 15 8.17745C15.0114 4.20832 11.8682 1 8.00579 1Z" fill="currentColor"></path></svg></a></li></ul><div class="BlogHeader_headerActions__GZU2w"><button class="SearchButton_searchButton__pKNuD" aria-label="Search blog posts"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="8.44444" cy="8.44444" r="4.69444" stroke="currentColor" stroke-width="1.5"></circle><path d="M11.5555 11.9444L16.6111 17" stroke="currentColor" stroke-width="1.5"></path></svg></button><a class="BlogHeader_joinBtn__8Kpkd" href="https://app.gitbutler.com"><span>Join GitButler</span><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><g opacity="0.6"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.25 5C2.25 2.92893 3.92893 1.25 6 1.25L10 1.25C12.0711 1.25 13.75 2.92893 13.75 5L13.75 11C13.75 13.0711 12.0711 14.75 10 14.75L6 14.75C3.92893 14.75 2.25 13.0711 2.25 11H3.75C3.75 12.2426 4.75736 13.25 6 13.25L10 13.25C11.2426 13.25 12.25 12.2426 12.25 11L12.25 5C12.25 3.75736 11.2426 2.75 10 2.75H6C4.75736 2.75 3.75 3.75736 3.75 5H2.25Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M7.03033 4.46967L10.5607 8L7.03033 11.5303L5.96967 10.4697L7.68934 8.75H0.5L0.5 7.25L7.68934 7.25L5.96967 5.53033L7.03033 4.46967Z"></path></g></svg></a></div></div><button class="BlogHeader_mobileMenuButton__Ltd_0 " aria-label="Toggle mobile menu"></button></div><div class="BlogHeader_mobileMenu__PYf3C "><div class="BlogHeader_mobileMenuSection__p79X5"><ul class="BlogHeader_mobileMenuLinks__sDKlW"><li><a target="_blank" href="https://gitbutler.com/downloads">Downloads</a></li><li><a target="_blank" href="https://docs.gitbutler.com">Docs</a></li><li><a target="_blank" href="https://discord.com/invite/MmFkmaJ42D"><span>Community</span><svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.5535 4.00498C12.5023 3.52873 11.3926 3.19086 10.2526 3C10.0966 3.27595 9.95547 3.55987 9.82976 3.85056C8.6155 3.66949 7.38067 3.66949 6.16641 3.85056C6.04064 3.5599 5.89949 3.27598 5.74357 3C4.60289 3.19247 3.4924 3.53114 2.44013 4.00747C0.351096 7.066 -0.215208 10.0486 0.0679444 12.9888C1.29133 13.8833 2.66066 14.5635 4.11639 15C4.44417 14.5637 4.73423 14.1009 4.98346 13.6164C4.51007 13.4415 4.05317 13.2256 3.61804 12.9714C3.73256 12.8892 3.84456 12.8045 3.95279 12.7223C5.21891 13.3115 6.60083 13.617 7.99997 13.617C9.39912 13.617 10.781 13.3115 12.0472 12.7223C12.1566 12.8107 12.2686 12.8954 12.3819 12.9714C11.9459 13.226 11.4882 13.4423 11.014 13.6177C11.2629 14.1019 11.553 14.5644 11.881 15C13.338 14.5653 14.7084 13.8853 15.932 12.99C16.2642 9.58032 15.3644 6.62516 13.5535 4.00498ZM5.34212 11.1806C4.55307 11.1806 3.90119 10.472 3.90119 9.60025C3.90119 8.72852 4.53042 8.0137 5.3396 8.0137C6.14879 8.0137 6.79563 8.72852 6.78179 9.60025C6.76795 10.472 6.14627 11.1806 5.34212 11.1806ZM10.6578 11.1806C9.86752 11.1806 9.21815 10.472 9.21815 9.60025C9.21815 8.72852 9.84738 8.0137 10.6578 8.0137C11.4683 8.0137 12.1101 8.72852 12.0962 9.60025C12.0824 10.472 11.462 11.1806 10.6578 11.1806Z" fill="currentColor"></path></svg></a></li><li><a target="_blank" href="https://github.com/gitbutlerapp/gitbutler"><span>Source code</span><svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.00579 1C4.13177 1 1 4.20832 1 8.17745C1 11.3502 3.00663 14.0358 5.79036 14.9864C6.1384 15.0578 6.26589 14.8319 6.26589 14.6419C6.26589 14.4755 6.25442 13.9052 6.25442 13.3109C4.30557 13.7388 3.89974 12.4553 3.89974 12.4553C3.58655 11.6235 3.1225 11.4097 3.1225 11.4097C2.48465 10.97 3.16896 10.97 3.16896 10.97C3.87651 11.0175 4.24778 11.7067 4.24778 11.7067C4.87402 12.7999 5.88315 12.491 6.28912 12.3009C6.34705 11.8374 6.53276 11.5166 6.72994 11.3384C5.1756 11.172 3.54023 10.5541 3.54023 7.79712C3.54023 7.01283 3.81844 6.37117 4.25926 5.87213C4.1897 5.69392 3.94606 4.95703 4.32895 3.97076C4.32895 3.97076 4.92048 3.78059 6.25427 4.70751C7.39742 4.39299 8.61414 4.39049 9.75717 4.70751C11.0911 3.78059 11.6826 3.97076 11.6826 3.97076C12.0655 4.95703 11.8217 5.69392 11.7522 5.87213C12.2046 6.37117 12.4714 7.01283 12.4714 7.79712C12.4714 10.5541 10.836 11.16 9.27003 11.3384C9.52529 11.5641 9.74555 11.9919 9.74555 12.6692C9.74555 13.6317 9.73408 14.4042 9.73408 14.6418C9.73408 14.8319 9.86171 15.0578 10.2096 14.9865C12.9933 14.0357 15 11.3502 15 8.17745C15.0114 4.20832 11.8682 1 8.00579 1Z" fill="currentColor"></path></svg></a></li></ul></div></div></nav><div class="grid-layout"><div class="page_postHeroAbout__iwVoh"><div class="page_postHeroMeta__1RIVN"><div class="page_postHeroMetaDetails__7_OC5"><p><time dateTime="Thu Jul 24 2025 14:58:56 GMT+0000 (Coordinated Universal Time)">4 months ago</time><span>¬†by¬†</span><a class="page_postHeroMetaAuthor__RdlNk" href="/author/schacon">Scott Chacon</a></p><div class="page_postHeroMetaTimeToRead__7ezeY"><svg class="page_postHeroMetaDetailsIcon__CwehT" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="8" cy="8.5" r="6.25" stroke="currentColor" stroke-width="1.5"></circle><path d="M8 1.5C9.22876 1.5 10.4359 1.82344 11.5 2.43782C12.5641 3.0522 13.4478 3.93587 14.0622 5C14.6766 6.06413 15 7.27124 15 8.5C15 9.72876 14.6766 10.9359 14.0622 12L8 8.5V1.5Z" fill="var(--clr-text-1)"></path></svg><span>10<!-- --> min read</span></div><div class="page_postHeroTags__gHQTB"><a class="page_articleTagItem__iQdOO" href="/tag/engineering">engineering</a></div></div></div><h1 class="page_postHeroTitle__07fIj">Automate Your AI Workflows with Claude Code Hooks</h1><p class="page_postHeroExcerpt___omPW">Claude Code&#x27;s new hooks system is a powerful tool for automating your agent workflows. We&#x27;ll do a quick overview of what&#x27;s possible and explore a few fun examples.</p></div><div class="page_postHeroImage__hed_3"><img src="https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-automate-with-claude.jpg" alt="Automate Your AI Workflows with Claude Code Hooks"/></div></div></div></div><div class="page_postContent__aM6Pg"><div class="grid-layout"><div class="page_postShareLinks__UFvCi"><a class="page_postShareBtn__MEHT_ page_hackernews__zhujN" href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fblog.gitbutler.com%2Fautomate-your-ai-workflows-with-claude-code-hooks&amp;t=Automate%20Your%20AI%20Workflows%20with%20Claude%20Code%20Hooks" aria-label="Share on Hacker News" target="_blank" rel="noopener"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M5 1C2.79086 1 1 2.79086 1 5V19C1 21.2091 2.79086 23 5 23H19C21.2091 23 23 21.2091 23 19V5C23 2.79086 21.2091 1 19 1H5ZM7.9957 4.64648H6L11.2001 13.4648V19.6465H12.9428V13.4648L18.1429 4.64648H16.1472L12.1558 11.6484H11.9871L7.9957 4.64648Z" fill="currentColor"></path></svg></a><a class="page_postShareBtn__MEHT_ page_blsk__A6pq_" href="https://bsky.app/intent/compose?text=Automate%20Your%20AI%20Workflows%20with%20Claude%20Code%20Hooks%20https%3A%2F%2Fblog.gitbutler.com%2Fautomate-your-ai-workflows-with-claude-code-hooks" aria-label="Share on BlueSky" target="_blank" rel="noopener"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.76879 4.27893C8.29104 6.13626 11.004 9.90214 12.0001 11.9231C12.9962 9.90228 15.709 6.13622 18.2313 4.27893C20.0513 2.93876 23 1.90182 23 5.20144C23 5.86042 22.6148 10.7372 22.3889 11.5289C21.6036 14.2815 18.7421 14.9836 16.1967 14.5587C20.646 15.3014 21.7778 17.7617 19.3335 20.2221C14.6911 24.8947 12.661 19.0497 12.1406 17.552C12.0453 17.2774 12.0007 17.149 12 17.2582C11.9993 17.149 11.9547 17.2774 11.8594 17.552C11.3392 19.0497 9.30916 24.8948 4.66654 20.2221C2.22213 17.7617 3.35395 15.3013 7.80331 14.5587C5.25785 14.9836 2.39627 14.2815 1.6111 11.5289C1.38518 10.7371 1 5.86034 1 5.20144C1 1.90182 3.94882 2.93876 5.76866 4.27893H5.76879Z" fill="currentColor"></path></svg></a><a class="page_postShareBtn__MEHT_ undefined" href="https://twitter.com/intent/tweet?text=Automate%20Your%20AI%20Workflows%20with%20Claude%20Code%20Hooks&amp;url=https%3A%2F%2Fblog.gitbutler.com%2Fautomate-your-ai-workflows-with-claude-code-hooks" target="_blank" aria-label="Share on X"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18.0113 3.32812H20.9237L14.5292 10.6873L22 20.6702H16.1373L11.5472 14.6037L6.29224 20.6702H3.37987L10.1543 12.7991L3 3.32812H9.00833L13.1553 8.8699L18.0113 3.32812ZM16.992 18.9424H18.6065L8.15995 4.99194H6.42519L16.992 18.9424Z" fill="currentColor"></path></svg></a><button class="page_postShareBtn__MEHT_ page_copyLink__VWGEa" aria-label="Copy link"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.96962 13.0303C1.60566 10.6664 1.60567 6.83365 3.96963 4.46969C6.33359 2.10573 10.1663 2.10573 12.5303 4.46969L14.4053 6.34469L13.3446 7.40535L11.4696 5.53035C9.69145 3.75217 6.80846 3.75217 5.03029 5.53035C3.25211 7.30852 3.25211 10.1915 5.03028 11.9697L6.90529 13.8447L5.84463 14.9053L3.96962 13.0303ZM20.0303 11.9697C22.3943 14.3337 22.3942 18.1664 20.0303 20.5303C17.6663 22.8943 13.8336 22.8943 11.4696 20.5303L9.59463 18.6553L10.6553 17.5947L12.5303 19.4697C14.3085 21.2479 17.1915 21.2479 18.9696 19.4697C20.7478 17.6915 20.7478 14.8085 18.9696 13.0303L17.0946 11.1553L18.1553 10.0947L20.0303 11.9697ZM15.863 15.3024L9.1963 8.6357L8.13564 9.69636L14.8023 16.363L15.863 15.3024Z" fill="currentColor"></path></svg></button></div><section class="page_mainContent__wkaHU"><div class="pageBody page_postContentBody__z7nsN"><p>A while ago we realized that a lot of our users were taking advantage of our rather unique <a href="https://docs.gitbutler.com/features/virtual-branches/virtual-branches" target="_blank" rel="noopener noreferrer">virtual branches</a> functionality in GitButler to manage the code that their coding agents were producing into multiple branches easily, so we started to work on better ways to interact with them.</p>
<p>What we really wanted to do was inspect what an agent was doing so we could automatically create save points that could easily be edited. Or even better, know what topic the agent was working on so we could try to group the changes into multiple branches.</p>
<p>However, most agents are almost entirely opaque - you can&#x27;t see anything that Cursor or Windsurf is doing, for example other than the files that they&#x27;re editing on disk.</p>
<h2 id="claude-code-hooks" class="page_headerWithAnchor__Rn6At"><span class="unified-h2">Claude Code Hooks</span><button class="page_anchorLink__ktNDZ" aria-label="Copy link to this section"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.96962 13.0303C1.60566 10.6664 1.60567 6.83365 3.96963 4.46969C6.33359 2.10573 10.1663 2.10573 12.5303 4.46969L14.4053 6.34469L13.3446 7.40535L11.4696 5.53035C9.69145 3.75217 6.80846 3.75217 5.03029 5.53035C3.25211 7.30852 3.25211 10.1915 5.03028 11.9697L6.90529 13.8447L5.84463 14.9053L3.96962 13.0303ZM20.0303 11.9697C22.3943 14.3337 22.3942 18.1664 20.0303 20.5303C17.6663 22.8943 13.8336 22.8943 11.4696 20.5303L9.59463 18.6553L10.6553 17.5947L12.5303 19.4697C14.3085 21.2479 17.1915 21.2479 18.9696 19.4697C20.7478 17.6915 20.7478 14.8085 18.9696 13.0303L17.0946 11.1553L18.1553 10.0947L20.0303 11.9697ZM15.863 15.3024L9.1963 8.6357L8.13564 9.69636L14.8023 16.363L15.863 15.3024Z" fill="currentColor"></path></svg></button></h2>
<p>However, recently Anthropic shipped <a href="https://docs.anthropic.com/en/docs/claude-code/hooks" target="_blank" rel="noopener noreferrer">lifecycle hooks</a> for their terminal based coding agent. These provide the ability to tell Claude to run a script whenever one of it&#x27;s sessions reaches any of these points:</p>
<ul>
<li><a href="https://docs.anthropic.com/en/docs/claude-code/hooks#userpromptsubmit" target="_blank" rel="noopener noreferrer">Prompt submission</a> (right before it starts working)</li>
<li><a href="https://docs.anthropic.com/en/docs/claude-code/hooks#pretooluse" target="_blank" rel="noopener noreferrer">Right before it uses a &quot;tool&quot;</a>
<ul>
<li>(file edit, file read, shell command, file search, web search, etc)</li>
</ul>
</li>
<li><a href="https://docs.anthropic.com/en/docs/claude-code/hooks#posttooluse" target="_blank" rel="noopener noreferrer">Right after it uses said tool</a></li>
<li><a href="https://docs.anthropic.com/en/docs/claude-code/hooks#notification" target="_blank" rel="noopener noreferrer">It needs information from you</a> (permission for tool use for example)</li>
<li><a href="https://docs.anthropic.com/en/docs/claude-code/hooks#precompact" target="_blank" rel="noopener noreferrer">Before it compacts it&#x27;s context</a></li>
<li><a href="https://docs.anthropic.com/en/docs/claude-code/hooks#stop" target="_blank" rel="noopener noreferrer">When it&#x27;s done</a></li>
</ul>
<p>That&#x27;s a lot of stuff. Which is awesome, because it means that now you can script all sorts of automations and extra workflow additions and controls that you simply cannot do with other code generation agents.</p>
<p>Since we just shipped a way to use GitButler to <a href="/parallel-claude-code/">automatically commit work into one lane per session</a> based on these hooks, and we learned a lot while implementing it, we thought we would show you how you can use this for fun and profit too.</p>
<p>So, here is a very simple tutorial on how you can add a pretty useful hook to your Claude Code workflow in a few minutes as an example of what this can do and how to set it up.</p>
<div class="Callout_callout__DBf_G Callout_info__50GFh"><span class="Callout_emoji__NaUKh">üí°</span><div class="Callout_content__WzsNi"><p>Hooks are a very recent addition to Claude Code, released initially in June 2025. I&#x27;m on <code>1.0.59</code> and you can easily update by running <code>claude update</code></p></div></div>
<h2 id="a-simple-example" class="page_headerWithAnchor__Rn6At"><span class="unified-h2">A simple example</span><button class="page_anchorLink__ktNDZ" aria-label="Copy link to this section"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.96962 13.0303C1.60566 10.6664 1.60567 6.83365 3.96963 4.46969C6.33359 2.10573 10.1663 2.10573 12.5303 4.46969L14.4053 6.34469L13.3446 7.40535L11.4696 5.53035C9.69145 3.75217 6.80846 3.75217 5.03029 5.53035C3.25211 7.30852 3.25211 10.1915 5.03028 11.9697L6.90529 13.8447L5.84463 14.9053L3.96962 13.0303ZM20.0303 11.9697C22.3943 14.3337 22.3942 18.1664 20.0303 20.5303C17.6663 22.8943 13.8336 22.8943 11.4696 20.5303L9.59463 18.6553L10.6553 17.5947L12.5303 19.4697C14.3085 21.2479 17.1915 21.2479 18.9696 19.4697C20.7478 17.6915 20.7478 14.8085 18.9696 13.0303L17.0946 11.1553L18.1553 10.0947L20.0303 11.9697ZM15.863 15.3024L9.1963 8.6357L8.13564 9.69636L14.8023 16.363L15.863 15.3024Z" fill="currentColor"></path></svg></button></h2>
<p>We&#x27;re going to add a simple hook that will make Claude send you a desktop notification when a session is completed.</p>
<p>Since we want to know when something is completed, we&#x27;ll use the <code>Stop</code> hook, which fires when everything in a session is done.</p>
<p>You can set up a hook in one of three places:</p>
<ul>
<li><code>~/.claude/settings.json</code>¬†- User settings, runs on any of your projects.</li>
<li><code>.claude/settings.json</code>¬†- Project settings, only runs on that project and should be committed (for the rest of your team)</li>
<li><code>.claude/settings.local.json</code>¬†- Local project settings, meant to not be committed, just for you.</li>
</ul>
<p>Claude Code should look for <em>all</em> of these files, and fire every hook that matches in any of them. Since what we&#x27;re doing is pretty generic and also platform specific, we&#x27;ll put it in the user settings (<code>~/.claude/settings.json</code>)</p>
<h2 id="how-to-do-a-desktop-notification-on-mac" class="page_headerWithAnchor__Rn6At"><span class="unified-h2">How to do a Desktop notification on Mac</span><button class="page_anchorLink__ktNDZ" aria-label="Copy link to this section"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.96962 13.0303C1.60566 10.6664 1.60567 6.83365 3.96963 4.46969C6.33359 2.10573 10.1663 2.10573 12.5303 4.46969L14.4053 6.34469L13.3446 7.40535L11.4696 5.53035C9.69145 3.75217 6.80846 3.75217 5.03029 5.53035C3.25211 7.30852 3.25211 10.1915 5.03028 11.9697L6.90529 13.8447L5.84463 14.9053L3.96962 13.0303ZM20.0303 11.9697C22.3943 14.3337 22.3942 18.1664 20.0303 20.5303C17.6663 22.8943 13.8336 22.8943 11.4696 20.5303L9.59463 18.6553L10.6553 17.5947L12.5303 19.4697C14.3085 21.2479 17.1915 21.2479 18.9696 19.4697C20.7478 17.6915 20.7478 14.8085 18.9696 13.0303L17.0946 11.1553L18.1553 10.0947L20.0303 11.9697ZM15.863 15.3024L9.1963 8.6357L8.13564 9.69636L14.8023 16.363L15.863 15.3024Z" fill="currentColor"></path></svg></button></h2>
<p>This should be simple, but it&#x27;s sadly <em>slightly</em> complicated.</p>
<p>On a Mac, you can run <code>osascript</code> to do a notification, but the catch is that if you&#x27;ve never done this before, you need to open up a program called Script Editor, run it manually first, give it system permissions, then you&#x27;re good going forward.</p>
<p><img src="https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-CleanShot-2025-07-23-at-16.07.50%402x.png" alt="" class=" clickable-image" style="cursor:pointer"/></p>
<figcaption><p>Find &#x27;Script Editor&#x27; under Notifications in your Settings and allow
notifications</p></figcaption>
<p>Once you have permissions, then you can just run something like this in your terminal to see a cool little notification and sound:</p>
<pre><code>$ osascript -e &#x27;display notification &quot;Nailed it&quot; with title &quot;Claude Code&quot; subtitle &quot;AI assistant&quot; sound name &quot;Glass&quot;
</code></pre>
<p><img src="https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-CleanShot-2025-07-23-at-16.12.09%402x.png" alt="" class=" clickable-image" style="cursor:pointer"/></p>
<figcaption>Nailed it.</figcaption>
<p>Ok, now we can do a simple desktop notification. Let&#x27;s make Claude nail it.</p>
<h2 id="adding-the-hook" class="page_headerWithAnchor__Rn6At"><span class="unified-h2">Adding the hook</span><button class="page_anchorLink__ktNDZ" aria-label="Copy link to this section"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.96962 13.0303C1.60566 10.6664 1.60567 6.83365 3.96963 4.46969C6.33359 2.10573 10.1663 2.10573 12.5303 4.46969L14.4053 6.34469L13.3446 7.40535L11.4696 5.53035C9.69145 3.75217 6.80846 3.75217 5.03029 5.53035C3.25211 7.30852 3.25211 10.1915 5.03028 11.9697L6.90529 13.8447L5.84463 14.9053L3.96962 13.0303ZM20.0303 11.9697C22.3943 14.3337 22.3942 18.1664 20.0303 20.5303C17.6663 22.8943 13.8336 22.8943 11.4696 20.5303L9.59463 18.6553L10.6553 17.5947L12.5303 19.4697C14.3085 21.2479 17.1915 21.2479 18.9696 19.4697C20.7478 17.6915 20.7478 14.8085 18.9696 13.0303L17.0946 11.1553L18.1553 10.0947L20.0303 11.9697ZM15.863 15.3024L9.1963 8.6357L8.13564 9.69636L14.8023 16.363L15.863 15.3024Z" fill="currentColor"></path></svg></button></h2>
<p>It&#x27;s possible that you already have something in some of these files, sometimes Claude will add <a href="https://docs.anthropic.com/en/docs/claude-code/settings#permission-settings" target="_blank" rel="noopener noreferrer">permissions rules</a> to your local project file, but you probably won&#x27;t have a User settings file yet, or it may be empty.</p>
<p>So, go ahead and make your <code>~/.claude/settings.json</code> look something like this:</p>
<div class="codeBlock CodeBlock_codeBlockWrapper__uk5mU language-json"><div class="CodeBlock_languageLabel__jnazF">JSON</div><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1rem;margin:0;overflow:auto;border-radius:0 0 8px 8px;font-size:0.9rem"><code style="white-space:pre;font-family:var(--font-mono)"><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;hooks&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>    </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;Stop&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span>
</span><span>      </span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>        </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;matcher&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>        </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;hooks&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span>
</span><span>          </span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>            </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;type&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;command&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>            </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;command&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;osascript -e &#x27;display notification \&quot;Claude has finished!\&quot; with title \&quot;‚úÖ Claude Done\&quot; sound name \&quot;Glass\&quot;&#x27;&quot;</span><span>
</span><span>          </span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span>
</span><span>        </span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span>
</span><span>      </span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span>
</span><span>    </span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span>
</span><span>  </span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span>
</span><span></span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span>
</span></code></pre></div>
<p>If we then run Claude anywhere, it will give us this little popup every time it&#x27;s finished with a chat based task.</p>
<p><img src="https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-CleanShot-2025-07-23-at-16.22.07%402x.png" alt="" class=" clickable-image" style="cursor:pointer"/></p>
<figcaption><p>You can&#x27;t hear it, but it also made a little ding sound.</p></figcaption>
<h2 id="a-massively-complicated-example" class="page_headerWithAnchor__Rn6At"><span class="unified-h2">A massively complicated example</span><button class="page_anchorLink__ktNDZ" aria-label="Copy link to this section"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.96962 13.0303C1.60566 10.6664 1.60567 6.83365 3.96963 4.46969C6.33359 2.10573 10.1663 2.10573 12.5303 4.46969L14.4053 6.34469L13.3446 7.40535L11.4696 5.53035C9.69145 3.75217 6.80846 3.75217 5.03029 5.53035C3.25211 7.30852 3.25211 10.1915 5.03028 11.9697L6.90529 13.8447L5.84463 14.9053L3.96962 13.0303ZM20.0303 11.9697C22.3943 14.3337 22.3942 18.1664 20.0303 20.5303C17.6663 22.8943 13.8336 22.8943 11.4696 20.5303L9.59463 18.6553L10.6553 17.5947L12.5303 19.4697C14.3085 21.2479 17.1915 21.2479 18.9696 19.4697C20.7478 17.6915 20.7478 14.8085 18.9696 13.0303L17.0946 11.1553L18.1553 10.0947L20.0303 11.9697ZM15.863 15.3024L9.1963 8.6357L8.13564 9.69636L14.8023 16.363L15.863 15.3024Z" fill="currentColor"></path></svg></button></h2>
<p>Ok, we have our cute example and you probably want to stop reading here. I&#x27;m sure you can take that, look at the hooks docs and figure out how to do all sorts of pretty cool things, like perhaps:</p>
<ul>
<li>Auto-formatting or linting after a file edit</li>
<li>Sensitive command blocking, like blacklisting an <code>rm -rf</code></li>
<li>Access controls to restrict changes to critical files or directories</li>
<li>Prompt validation to analyze or sanitize user prompts before processing</li>
<li>Auto documentation, for example firing off a background process to re-document affected files</li>
<li>Storing session transcripts to automatically keep all the transcripts of everything you&#x27;ve done in Claude somewhere</li>
</ul>
<p>Whatever, the world is your Claude-based oyster.</p>
<p>I was just going to end here, but I figured it might be fun to really get into the weeds and even abuse Git a little along the way.</p>
<p>What I&#x27;ll do now is implement a poor-man&#x27;s version of what the GitButler client does with it&#x27;s <a href="https://docs.gitbutler.com/features/ai-integration/claude-code-hooks" target="_blank" rel="noopener noreferrer">Claude Code hooks integration</a>, which is to create a new commit after every chat session is finished. To make the task much more complicated and abuse Git the way I promised, we&#x27;ll even store changes from multiple simultaneous running sessions in different branches.</p>
<p>Let&#x27;s do some fun Git magic.</p>
<h2 id="version-one-auto-committing" class="page_headerWithAnchor__Rn6At"><span class="unified-h2">Version One: Auto Committing</span><button class="page_anchorLink__ktNDZ" aria-label="Copy link to this section"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.96962 13.0303C1.60566 10.6664 1.60567 6.83365 3.96963 4.46969C6.33359 2.10573 10.1663 2.10573 12.5303 4.46969L14.4053 6.34469L13.3446 7.40535L11.4696 5.53035C9.69145 3.75217 6.80846 3.75217 5.03029 5.53035C3.25211 7.30852 3.25211 10.1915 5.03028 11.9697L6.90529 13.8447L5.84463 14.9053L3.96962 13.0303ZM20.0303 11.9697C22.3943 14.3337 22.3942 18.1664 20.0303 20.5303C17.6663 22.8943 13.8336 22.8943 11.4696 20.5303L9.59463 18.6553L10.6553 17.5947L12.5303 19.4697C14.3085 21.2479 17.1915 21.2479 18.9696 19.4697C20.7478 17.6915 20.7478 14.8085 18.9696 13.0303L17.0946 11.1553L18.1553 10.0947L20.0303 11.9697ZM15.863 15.3024L9.1963 8.6357L8.13564 9.69636L14.8023 16.363L15.863 15.3024Z" fill="currentColor"></path></svg></button></h2>
<p>Your should be able to figure out how to do this on a very basic level, since we already are running a command when a session finishes. It&#x27;s fairly straightforward to change the notification into a <code>git commit -m checkpoint</code>. You can always clean up and edit the commits later, but it gives you rollback points to just about anywhere.</p>
<p>However, let&#x27;s make it slightly better by using the <em>prompt itself</em> as the commit message.</p>
<p>This introduces a new concept to the hooks, which is <a href="https://docs.anthropic.com/en/docs/claude-code/hooks#hook-input" target="_blank" rel="noopener noreferrer">hook input</a>. Every hook gets called with json data passed to <code>stdin</code>, the format of which depends on the hook. In the case of the <code>Stop</code> hook, we get something like this:</p>
<div class="codeBlock CodeBlock_codeBlockWrapper__uk5mU language-json"><div class="CodeBlock_languageLabel__jnazF">JSON</div><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1rem;margin:0;overflow:auto;border-radius:0 0 8px 8px;font-size:0.9rem"><code style="white-space:pre;font-family:var(--font-mono)"><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;session_id&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;eb5b0174-0555-4601-804e-672d68069c89&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;transcript_path&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;/Users/schacon/.claude/projects/-Users-schacon-projects-testing/eb5b0174-0555-4601-804e-672d68069c89.jsonl&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;cwd&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;/Users/schacon/projects/testing&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;hook_event_name&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;Stop&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;stop_hook_active&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">false</span><span>
</span><span></span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span>
</span></code></pre></div>
<p>So, you can see immediately some useful data:</p>
<ul>
<li>A session ID, so simultaneous instances of Claude Code can be differentiated.</li>
<li>A working directory, so we know what project this is being run in.</li>
<li>A transcript, which is going to be the most important - this is everything you&#x27;ve seen on the screen during the session, and a lot that was hidden.</li>
</ul>
<p>The transcript file is actually a JSONL file (JSON &quot;lines&quot; format), so each line is an individual json object - makes it easy to keep concatenating new json content. Each entry (line) looks something like this:</p>
<div class="codeBlock CodeBlock_codeBlockWrapper__uk5mU language-json"><div class="CodeBlock_languageLabel__jnazF">JSON</div><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1rem;margin:0;overflow:auto;border-radius:0 0 8px 8px;font-size:0.9rem"><code style="white-space:pre;font-family:var(--font-mono)"><span>‚ùØ head </span><span class="token" style="color:hsl(29, 54%, 61%)">-1</span><span> /Users/schacon/.claude/projects/-Users-schacon-projects-testing/eb5b0174</span><span class="token" style="color:hsl(29, 54%, 61%)">-0555</span><span class="token" style="color:hsl(29, 54%, 61%)">-4601</span><span>-804e-672d68069c89.jsonl | jq
</span><span></span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;parentUuid&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">null</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;isSidechain&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">false</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;userType&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;external&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;cwd&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;/Users/schacon/projects/testing&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;sessionId&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;eb5b0174-0555-4601-804e-672d68069c89&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;version&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;1.0.58&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;gitBranch&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;type&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;user&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;message&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>    </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;role&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;user&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>    </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;content&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;add rick to the readme&quot;</span><span>
</span><span>  </span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;uuid&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;b4575262-5ecc-4188-abe3-82c4eef91120&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;timestamp&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;2025-07-23T15:00:55.015Z&quot;</span><span>
</span><span></span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span>
</span></code></pre></div>
<p>Another interesting thing to notice here is where it keeps these transcript files. If you go into <code>~/.claude/projects</code> you can see a list of every project where you&#x27;ve run Claude Code. Inside each project directory is a transcript file for every session you&#x27;ve done. It&#x27;s actually pretty cool.</p>
<h3 id="enough-blah-blah-let-s-write-our-auto-committing-script" class="page_headerWithAnchor__Rn6At"><span class="unified-h3">Enough blah blah, let&#x27;s write our auto-committing script</span><button class="page_anchorLink__ktNDZ" aria-label="Copy link to this section"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.96962 13.0303C1.60566 10.6664 1.60567 6.83365 3.96963 4.46969C6.33359 2.10573 10.1663 2.10573 12.5303 4.46969L14.4053 6.34469L13.3446 7.40535L11.4696 5.53035C9.69145 3.75217 6.80846 3.75217 5.03029 5.53035C3.25211 7.30852 3.25211 10.1915 5.03028 11.9697L6.90529 13.8447L5.84463 14.9053L3.96962 13.0303ZM20.0303 11.9697C22.3943 14.3337 22.3942 18.1664 20.0303 20.5303C17.6663 22.8943 13.8336 22.8943 11.4696 20.5303L9.59463 18.6553L10.6553 17.5947L12.5303 19.4697C14.3085 21.2479 17.1915 21.2479 18.9696 19.4697C20.7478 17.6915 20.7478 14.8085 18.9696 13.0303L17.0946 11.1553L18.1553 10.0947L20.0303 11.9697ZM15.863 15.3024L9.1963 8.6357L8.13564 9.69636L14.8023 16.363L15.863 15.3024Z" fill="currentColor"></path></svg></button></h3>
<p>Now, there are a few different ways we could do this auto-committing script.</p>
<p>We could use the <code>UserPromptSubmit</code> to store the latest prompt in a tempfile and then commit using that as the message when we get a <code>Stop</code> call, but instead we&#x27;re going to just run a single command at the <code>Stop</code> hook that figures out what the last prompt was from the transcript, then add all the files and commit.</p>
<p>So, let&#x27;s change the <code>~/.claude/settings.json</code> to run a new script of ours and get that script to do all of that. Instead of the <code>ocascript</code> line, just point it at a script of yours. Let&#x27;s say we put it in <code>~/bin/post_chat.rb</code>:</p>
<div class="codeBlock CodeBlock_codeBlockWrapper__uk5mU language-json"><div class="CodeBlock_languageLabel__jnazF">JSON</div><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1rem;margin:0;overflow:auto;border-radius:0 0 8px 8px;font-size:0.9rem"><code style="white-space:pre;font-family:var(--font-mono)"><span>‚ùØ cat ~/.claude/settings.json
</span><span></span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>  </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;hooks&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>    </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;Stop&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span>
</span><span>      </span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>        </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;matcher&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>        </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;hooks&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span>
</span><span>          </span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>            </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;type&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;command&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>            </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;command&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;/Users/schacon/bin/post_chat.rb&quot;</span><span>
</span><span>          </span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span>
</span><span>        </span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span>
</span><span>      </span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span>
</span><span>    </span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span>
</span><span>  </span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span>
</span><span></span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span>
</span></code></pre></div>
<figcaption><p>Our new settings file, with our new Stop hook script</p></figcaption>
<p>I am of course using Ruby here, both because it&#x27;s the best language in the world, but also because it&#x27;s pretty pseudo-code-y, so it should be easy to follow.</p>
<p>So, here is my script, which:</p>
<ul>
<li>Reads the JSON input from stdin and parses it</li>
<li>Pulls out the transcript path and project directory</li>
<li>Changes to the project directory</li>
<li>Finds the last entry that was a user prompt</li>
<li>Create temporary file with the message content</li>
<li>Adds all the changed files to Git</li>
<li>Runs a git commit</li>
<li>Also (for fun), does a Mac desktop notification with the commit message</li>
</ul>
<p>Check it out:</p>
<p>Pretty straightforward. Now every time a chat session ends, you should automatically get a commit to whatever branch you&#x27;re on.</p>
<h2 id="version-two-beast-mode-multiple-branches" class="page_headerWithAnchor__Rn6At"><span class="unified-h2">Version Two, Beast Mode: Multiple Branches</span><button class="page_anchorLink__ktNDZ" aria-label="Copy link to this section"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.96962 13.0303C1.60566 10.6664 1.60567 6.83365 3.96963 4.46969C6.33359 2.10573 10.1663 2.10573 12.5303 4.46969L14.4053 6.34469L13.3446 7.40535L11.4696 5.53035C9.69145 3.75217 6.80846 3.75217 5.03029 5.53035C3.25211 7.30852 3.25211 10.1915 5.03028 11.9697L6.90529 13.8447L5.84463 14.9053L3.96962 13.0303ZM20.0303 11.9697C22.3943 14.3337 22.3942 18.1664 20.0303 20.5303C17.6663 22.8943 13.8336 22.8943 11.4696 20.5303L9.59463 18.6553L10.6553 17.5947L12.5303 19.4697C14.3085 21.2479 17.1915 21.2479 18.9696 19.4697C20.7478 17.6915 20.7478 14.8085 18.9696 13.0303L17.0946 11.1553L18.1553 10.0947L20.0303 11.9697ZM15.863 15.3024L9.1963 8.6357L8.13564 9.69636L14.8023 16.363L15.863 15.3024Z" fill="currentColor"></path></svg></button></h2>
<p>Now, this won&#x27;t exactly work in all circumstances, but let&#x27;s try to do something crazy, just for fun.</p>
<p>Let&#x27;s see how close we can get to what GitButler does - figure out what files are changed <em>in parallel</em> <em>sessions</em> and commit only the changes in those files to independent branches.</p>
<p>The plan is:</p>
<ul>
<li>Every time a file is modified, we get a <code>PreToolUse</code> hook and session ID.</li>
<li>Create a new index that is just for that session if it doesn&#x27;t exist and populate it with the contents of the last commit on the active branch (<code>HEAD</code>), giving us a base.</li>
<li>When a file is done being modified with <code>PostToolUse</code>, we will add it (and only it) to our session index.</li>
<li>When a <code>Stop</code> is issued, we will commit that index&#x27;s tree to a fake branch under <code>refs/heads/claude/&lt;session-id&gt;</code> so each session&#x27;s histories are seperate.</li>
</ul>
<p>Now, this will commit changes to the same file to both session&#x27;s branches because we can&#x27;t easily do partial hunk staging in the Git CLI (as we can in GitButler) but it&#x27;s still pretty fun.</p>
<h2 id="enough-blah-blah-let-s-write-this-beast" class="page_headerWithAnchor__Rn6At"><span class="unified-h2">Enough blah blah, let&#x27;s write this beast</span><button class="page_anchorLink__ktNDZ" aria-label="Copy link to this section"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.96962 13.0303C1.60566 10.6664 1.60567 6.83365 3.96963 4.46969C6.33359 2.10573 10.1663 2.10573 12.5303 4.46969L14.4053 6.34469L13.3446 7.40535L11.4696 5.53035C9.69145 3.75217 6.80846 3.75217 5.03029 5.53035C3.25211 7.30852 3.25211 10.1915 5.03028 11.9697L6.90529 13.8447L5.84463 14.9053L3.96962 13.0303ZM20.0303 11.9697C22.3943 14.3337 22.3942 18.1664 20.0303 20.5303C17.6663 22.8943 13.8336 22.8943 11.4696 20.5303L9.59463 18.6553L10.6553 17.5947L12.5303 19.4697C14.3085 21.2479 17.1915 21.2479 18.9696 19.4697C20.7478 17.6915 20.7478 14.8085 18.9696 13.0303L17.0946 11.1553L18.1553 10.0947L20.0303 11.9697ZM15.863 15.3024L9.1963 8.6357L8.13564 9.69636L14.8023 16.363L15.863 15.3024Z" fill="currentColor"></path></svg></button></h2>
<p>Instead of actually embedding the full files here, which I&#x27;m sure you don&#x27;t want to read as it&#x27;s quite repetitive, I&#x27;ll just link a GitHub repo with the three files (<code>pre_tool_call.rb</code>, <code>post_tool_call.rb</code> and <code>stop_call.rb</code>) here:</p>
<p><img src="https://d2m1ukvwmu7gz4.cloudfront.net/images/images-2025-07-CleanShot-2025-07-23-at-21.31.25%402x.png" alt="" class=" clickable-image" style="cursor:pointer"/></p>
<p>Let&#x27;s look at the interesting bits.</p>
<p>For the <a href="https://github.com/schacon/cc-hooks-auto-commit/blob/main/pre_tool_call.rb" target="_blank" rel="noopener noreferrer"><code>PreToolUse</code> call</a>, it gets the <code>stdin</code> data similar to the previous script, then does this:</p>
<div class="codeBlock CodeBlock_codeBlockWrapper__uk5mU language-ruby"><div class="CodeBlock_languageLabel__jnazF">RUBY</div><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1rem;margin:0;overflow:auto;border-radius:0 0 8px 8px;font-size:0.9rem"><code style="white-space:pre;font-family:var(--font-mono)"><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic"># Write index file if it&#x27;s not there yet</span><span>
</span><span>index_dir </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">File</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>join</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>cwd</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token string-literal" style="color:hsl(95, 38%, 62%)">&#x27;.git&#x27;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token string-literal" style="color:hsl(95, 38%, 62%)">&#x27;claude&#x27;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token string-literal" style="color:hsl(95, 38%, 62%)">&#x27;indexes&#x27;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> session_id</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span></span><span class="token" style="color:hsl(286, 60%, 67%)">unless</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">Dir</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>exist</span><span class="token" style="color:hsl(207, 82%, 66%)">?</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>index_dir</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>  FileUtils</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>mkdir_p</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>index_dir</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>  index_file </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">File</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>join</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>index_dir</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token string-literal" style="color:hsl(95, 38%, 62%)">&#x27;index&#x27;</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>  system</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token string-literal" style="color:hsl(95, 38%, 62%)">&quot;git read-tree --index-output=</span><span class="token string-literal interpolation delimiter" style="color:hsl(220, 14%, 71%)">#{</span><span class="token string-literal interpolation">index_file</span><span class="token string-literal interpolation delimiter" style="color:hsl(220, 14%, 71%)">}</span><span class="token string-literal" style="color:hsl(95, 38%, 62%)"> HEAD&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>  base_commit </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token command-literal command" style="color:hsl(95, 38%, 62%)">`git rev-parse HEAD`</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>strip
</span><span>  </span><span class="token" style="color:hsl(95, 38%, 62%)">File</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>write</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(95, 38%, 62%)">File</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>join</span><span class="tok